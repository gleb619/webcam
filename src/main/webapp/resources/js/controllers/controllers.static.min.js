"use strict";var tourismApp=angular.module("tourismApp.controllers.static",[]);tourismApp.run(function($rootScope,$templateCache){$rootScope.$on("$viewContentLoaded",function(){$templateCache.removeAll();});});tourismApp.controller("IndexCtrl",["$scope","$rootScope","$location","$filter","$timeout","$staticStorage",function($scope,$rootScope,$location,$filter,$timeout,$staticStorage){$scope.lastMonth=new Date(),$scope.currentMonth=new Date(),$scope.nextMonth=new Date();$scope.lastMonth.setMonth($scope.lastMonth.getMonth()-1);$scope.nextMonth.setMonth($scope.nextMonth.getMonth()+1);$scope.modules=[];$scope.openTimeLine=function(date){date=$filter("date")(date,"yyyy-MM-dd");$location.path("/timeline").search({date:date});if($location.path().indexOf("timeline")>-1){$location.search({date:date});}$("#menu-toggle").click();};$scope.clock="00:00",$scope.tickInterval=100;var tick=function(){$scope.clock=Date.now(),$timeout(tick,$scope.tickInterval);};$timeout(tick,$scope.tickInterval);$scope.tickInterval=10000;$scope.isActive=function(route){return route===$location.path();};$rootScope.$on("$routeChangeStart",function(){$rootScope.loading=true;});$rootScope.$on("$routeChangeSuccess",function(){$rootScope.loading=false;});$scope.userAgent=navigator.userAgent;setTimeout(function(){$scope.modules=$staticStorage.modules().data;},10);}]);tourismApp.controller("ErrorCtrl",["$scope","$modalInstance","modalSettings",function($scope,$modalInstance,modalSettings){$scope.item={head:modalSettings.head,body:modalSettings.body};$scope.cancel=function(){$modalInstance.dismiss("cancel");};}]);tourismApp.controller("RuserCtrl",["$scope",function($scope){}]);tourismApp.controller("ShopHotelRequestCtrl",["$scope","$servicesStorage","$location","$route","$modalInstance","modalSettings","$filter",function($scope,$servicesStorage,$location,$route,$modalInstance,modalSettings,$filter){$scope.loading=true,$scope.item={},$scope.today=new Date(),$scope.racetime=new Date(),$scope.departuretime=new Date(),$scope.datePicker={departureOpened:false,raceOpened:false},$scope.format="dd-MM-yyyy",$scope.excludes=["servhotel"],$scope.scrollableSettings={id:modalSettings.editItemId,dataLoading:true},$scope.scrollable={id:modalSettings.editItemId,initDicts:true,initLists:true,list:["servHotelRooms.relServHotelRoomImages","servHotelRooms.paymentTariffs.paymentPrices.currCurrency"]},$scope.reqitem={servhotelroom:{},relReqServHotelTmContactEasies:[{manFoman:false}]},$scope.tabsFocus={hotel:{main:true,servhotelroom:true},request:{main:false,request:false,contact:false}};$scope.view={getView:function(){return"notFound";}};$scope.checkVisibility=function(name){return $scope.excludes.indexOf(name)==-1;};$scope.open=function($event,name){if(!$scope[name]){$event.preventDefault();$event.stopPropagation();}$scope.datePicker[name]=true;};$scope.request=function(item){$scope.reqitem.servhotelroom=item;$scope.reqitem.label=item.label;$scope.tabsFocus.hotel.main=false;$scope.tabsFocus.request.main=true;$scope.tabsFocus.request.request=true;};$scope.convertDateAndTime=function(value,name){$scope.reqitem[name]=$filter("date")(value,"yyyy-MM-dd HH:mm:ss");};$scope.addrelReqServHotelTmContactEasies=function(){$scope.reqitem.relReqServHotelTmContactEasies.push({manFoman:false});};$scope.removerelReqServHotelTmContactEasies=function(row){$scope.reqitem.relReqServHotelTmContactEasies.splice($scope.reqitem.relReqServHotelTmContactEasies.indexOf(row),1);};$scope.canDeleterelReqServHotelTmContactEasies=function(){return $scope.reqitem.relReqServHotelTmContactEasies.length<=1;};$scope.next=function(){if($scope.tabsFocus.hotel.main){$scope.tabsFocus.hotel.main=false;$scope.tabsFocus.request.main=true;}else{if($scope.tabsFocus.request.contact){$scope.tabsFocus.request.request=true;$scope.tabsFocus.request.contact=false;}else{if($scope.tabsFocus.request.request){$scope.tabsFocus.request.request=false;$scope.tabsFocus.request.contact=true;}}}return true;};$scope.cancel=function(){$scope.loading=true;$modalInstance.dismiss("cancel");};$scope.submit=function(){$scope.loading=true;console.info("$scope.reqitem",$scope.reqitem);$scope.reqitem=JSOG.stringify($scope.reqitem);$servicesStorage.ReqServHotelDao().create($scope.reqitem,function(data){var result={item:{}};if(data.success&&data.data.length>0){result.item=JSOG.decode(data.data[0]);}else{result.item=JSOG.parse($scope.reqitem);}console.info("result",result);$modalInstance.close(result);});};setTimeout(function(){console.info("$scope.scrollable",$scope.scrollable);$servicesStorage.ServHotelDao().showObj($scope.scrollable,function(data){$scope.item=JSOG.decode(data.data);console.info("$scope.item",$scope.item);$scope.loading=false;});$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByPlacementId=JSOG.decode(data.data);});$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByPaymentTypeId=JSOG.decode(data.data);});$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByFoodId=JSOG.decode(data.data);});$scope.dataLocationCountries=$scope.$storage.dataLocationCountries;$servicesStorage.LocationCountriesDao().list({},function(data){$scope.dataLocationCountries=JSOG.decode(data.data);$scope.$storage.dataLocationCountries=$scope.dataLocationCountries;});},100);}]);tourismApp.controller("ShopHotelLandscapeCtrl",["$scope","$servicesStorage","$localStorage","toaster",function($scope,$servicesStorage,$localStorage,toaster){$scope.scrollable={pageNumber:1,pageSize:20,dataLoading:true,initLoading:true},$scope.$storage=$localStorage.$default({dataShopServHotelView:[]});$scope.loadData=function(callback){$scope.scrollable.dataLoading=true;$servicesStorage.ShopServHotelViewDao().listScrollable($scope.scrollable,function(data){$scope.scrollable.dataLoading=false;if(data.success){$scope.data=APP.uniqueArray($scope.data.concat(JSOG.decode(data.data)));$scope.$storage.dataShopServHotelView=$scope.data;}else{toaster.pop("error",data.message);$scope.settings.pageNumber--;}});$scope.scrollable.pageNumber++;if(callback){callback();}};$scope.data=$scope.$storage.dataShopServHotelView;setTimeout(function(){$scope.data=[];$scope.loadData(function(){$scope.scrollable.initLoading=false;});},100);}]);tourismApp.controller("ShopHotelLandscapeEditCtrl",["$scope","$staticStorage","$servicesStorage","$localStorage","toaster","$routeParams","$filter","$location",function($scope,$staticStorage,$servicesStorage,$localStorage,toaster,$routeParams,$filter,$location){$scope.scrollable={id:$routeParams.id,initDicts:true,initLists:true,list:["servHotelRooms.relServHotelRoomImages","servHotelRooms.paymentTariffs.paymentPrices.currCurrency"],dataLoading:true},$scope.datePicker={},$scope.priceFilter={label:"currcurrency",value:"dollar"},$scope.reqitem={relReqServHotelTmContactEasies:[]},$scope.requestinformation={relReqServHotelTmContactEasies:[{manFoman:false}]},$scope.$storage=$localStorage.$default({itemServHotel:[]});$scope.convertDateAndTime=function(value,name){$scope.reqitem[name]=$filter("date")(value,"yyyy-MM-dd HH:mm:ss");};$scope.createLeads=function(){$scope.reqitem.sync=false;$scope.requestinformation.relReqServHotelTmContactEasies.forEach(function(item){$scope.reqitem.relReqServHotelTmContactEasies.push({tmcontacteasy:item});});return JSOG.stringify($scope.reqitem);};$scope.submit=function(){$scope.scrollable.dataLoading=true;$staticStorage.ReqServHotelDao().create($scope.createLeads(),function(response){console.info("result",response);$scope.scrollable.dataLoading=false;});};$scope.pickRoom=function(room){$scope.requestinformation.breakfast=room.breakfast;$scope.requestinformation.dictglobalbyfood=room.dictglobalbyfood;$scope.reqitem.servhotel=room.servhotel;$scope.reqitem.servhotelroom=room;$scope.reqitem.label=room.servhotel.label+" - "+room.label;if(room.servhotel.timerace){$scope.reqitem.race=new Date(room.servhotel.timerace);$scope.convertDateAndTime($scope.reqitem.race,"race");}if(room.servhotel.departure){$scope.reqitem.departure=new Date(room.servhotel.timedeparture);$scope.convertDateAndTime($scope.reqitem.departure,"departure");}};$scope.open=function($event,name){$event.preventDefault();$event.stopPropagation();$scope.datePicker[name]=true;};$scope.add=function(){$scope.requestinformation.relReqServHotelTmContactEasies.push({manFoman:false});};$scope.deleteElement=function(element,source){var index=source.indexOf(element);source.splice(index,1);};setTimeout(function(){$servicesStorage.ServHotelDao().showObj($scope.scrollable,function(data){if(data.success){$scope.item=JSOG.decode(data.data);}else{toaster.pop("error",data.message);}$scope.scrollable.dataLoading=false;});$scope.dataDictGlobalByPlacementId=$scope.$storage.dataDictGlobalByPlacementId;$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByPlacementId=JSOG.decode(data.data);$scope.$storage.dataDictGlobalByPlacementId=$scope.dataDictGlobalByPlacementId;});$scope.dataDictGlobalByPaymentTypeId=$scope.$storage.dataDictGlobalByPaymentTypeId;$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByPaymentTypeId=JSOG.decode(data.data);$scope.$storage.dataDictGlobalByPaymentTypeId=$scope.dataDictGlobalByPaymentTypeId;});$scope.dataDictGlobalByFoodId=$scope.$storage.dataDictGlobalByFoodId;$servicesStorage.DictGlobalDao().list({},function(data){$scope.dataDictGlobalByFoodId=JSOG.decode(data.data);$scope.$storage.dataDictGlobalByFoodId=$scope.dataDictGlobalByFoodId;});$scope.dataLocationCountries=$scope.$storage.dataLocationCountries;$servicesStorage.LocationCountriesDao().list({},function(data){$scope.dataLocationCountries=JSOG.decode(data.data);$scope.$storage.dataLocationCountries=$scope.dataLocationCountries;});},100);}]);tourismApp.controller("ShopHotelCtrl",["$scope","servHotelDao","$location","$route","$modal",function($scope,servHotelDao,$location,$route,$modal){$scope.data=[],$scope.searchKeyword="",$scope.event="",$scope.attemptsNumber=0,$scope.dataLoading=true,$scope.modalOpening=false,$scope.isAdvancedSearch=false,$scope.total=100,$scope.settings={initDicts:true,initLists:false,pageNumber:1,pageSize:10,list:["relServHotelImages"]};$scope.checkVisibility=function(name){return true;};$scope.loadData=function(){$scope.attemptsNumber++;$scope.dataLoading=true;servHotelDao.listViewScrollable($scope.settings,function(data){$scope.dataLoading=false;if($scope.total>0){$scope.data=$scope.data.concat(JSOG.decode(data.data));}});$scope.settings.pageNumber++;};$scope.request=function(itemId){$scope.modalOpening=true;var modalInstance=$modal.open({templateUrl:"servhotelDetail/"+itemId,controller:"ShopHotelRequestCtrl",backdrop:"static",animate:true,resolve:{modalSettings:function(){return{item:$scope.selectedItem,mode:"edit",editItem:$scope.selectedItem,editItemId:itemId,excludeList:["servhotel"]};}}});modalInstance.result.then(function(selectedItem){$scope.modalOpening=false;},function(){$scope.modalOpening=false;});};setTimeout(function(){$scope.loadData();},APP.timeOutCount("ServHotel"));}]);tourismApp.controller("UploadImageCtrl",["$scope","FileUploader","$modalInstance",function($scope,FileUploader,$modalInstance){$scope.loading=false,$scope.list=[];var uploader=$scope.uploader=new FileUploader({url:"../image/upload"});uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1;}});uploader.onSuccessItem=function(fileItem,response,status,headers){if(response.success&&response.data.length>0){$scope.list.push(response.data[0]);}};uploader.onCompleteAll=function(){$modalInstance.close({data:$scope.list});};$scope.submitFunc=function(){$scope.loading=true;$scope.uploader.uploadAll();};$scope.cancel=function(){$modalInstance.dismiss("cancel");};}]);tourismApp.controller("UploadDocumentCtrl",["$scope","FileUploader","$modalInstance","toaster",function($scope,FileUploader,$modalInstance,toaster){$scope.loading=false,$scope.uploading=false,$scope.list=[];var uploader=$scope.uploader=new FileUploader({url:"../document/upload"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10;}});uploader.onSuccessItem=function(fileItem,response,status,headers){if(response.success){$scope.list.push(response.data);}else{toaster.pop("error",response.message);}};uploader.onCompleteAll=function(){$modalInstance.close({data:$scope.list});};$scope.submitFunc=function(){$scope.loading=true;$scope.uploading=true;$scope.uploader.uploadAll();};$scope.cancel=function(){$modalInstance.dismiss("cancel");};}]);tourismApp.controller("LogsListCtrl",["$scope","LogsServiceList","$location","$route",function($scope,LogsServiceList,$location,$route){$scope.searchKeyword="",$scope.data=[],$scope.headers=[],$scope.currentPage=1,$scope.numPerPage=100;$scope.editItem=function(itemId){};$scope.createNewItem=function(){};$scope.reloadData=function(){$route.reload();};$scope.checkForNull=function(){$scope.access=true;if($scope.total!=null&&$scope.total<=0){$scope.emptymsg="No data for representation";$scope.access=false;}if($scope.msg!=null){$scope.emptymsg=$scope.msg;$scope.access=false;}return $scope.access;};LogsServiceList.list({},function(data){$scope.msg=data.message;$scope.total=data.total;$scope.data=data.data;$scope.headers=data.headers;$scope.filteredLogs=$scope.data.slice(0,$scope.numPerPage);$scope.totalItems=Math.round($scope.data.length/$scope.numPerPage);});$scope.pageChanged=function(){var begin=(($scope.currentPage-1)*$scope.numPerPage),end=begin+$scope.numPerPage;$scope.filteredLogs=$scope.data.slice(begin,end);};}]);tourismApp.controller("LocalizationListCtrl",["$scope","LocalizationServiceList","$location","$route","toaster",function($scope,LocalizationServiceList,$location,$route,toaster){$scope.searchKeyword="",$scope.data=[],$scope.currentPage=1,$scope.numPerPage=50;$scope.sync=function(){LocalizationServiceList.createItem($scope.data,function(data){if(data.success){toaster.pop("success","Localization",JSON.stringify(data));}else{toaster.pop("danger","Localization",JSON.stringify(data));}});};$scope.reloadData=function(){$route.reload();};$scope.checkForNull=function(){$scope.access=true;if($scope.total!=null&&$scope.total<=0){$scope.emptymsg="No data for representation";$scope.access=false;}if($scope.msg!=null){$scope.emptymsg=$scope.msg;$scope.access=false;}return $scope.access;};LocalizationServiceList.list({},function(data){$scope.msg=data.message;$scope.total=data.total;$scope.data=data.data;$scope.filteredData=$scope.data.slice(0,$scope.numPerPage);$scope.totalItems=Math.round($scope.data.length/$scope.numPerPage);$scope.headers=data.headers;});$scope.pageChanged=function(){var begin=(($scope.currentPage-1)*$scope.numPerPage),end=begin+$scope.numPerPage;$scope.filteredData=$scope.data.slice(begin,end);};}]);tourismApp.controller("TimelineCtrl",["$scope","$routeParams","$location","$staticStorage","$filter",function($scope,$routeParams,$location,$staticStorage,$filter){$scope.datesettings={isRange:false,rangeStart:"",rangeEnd:"",date:$routeParams.date,loading:true,isNumberRange:false,numberRange:0},$scope.data=[],$scope.details={},$scope.selecttypes=[{name:"Day",value:false},{name:"Range",value:true}];$scope.customDate=function(range){var date=new Date();if(range=="last-ten"){$scope.datesettings.isNumberRange=true;$scope.datesettings.numberRange=10;$scope.searchByDate(date);return;}if(range=="last-day"){date.setDate(date.getDate()-1);$scope.datesettings.isRange=false;}else{if(range=="last-week"){date.setDate(date.getDate()-7);$scope.datesettings.rangeStart=formatedDate(date);$scope.datesettings.rangeEnd=formatedDate(new Date());$scope.datesettings.isRange=true;}else{if(range=="last-month"){date.setDate(date.getDate()-31);$scope.datesettings.rangeStart=formatedDate(date);$scope.datesettings.rangeEnd=formatedDate(new Date());$scope.datesettings.isRange=true;}}}$scope.datesettings.date=formatedDate(date);$scope.searchByDate(date);};$scope.open=function($event,name){$event.preventDefault();$event.stopPropagation();$scope.details[name]=true;};$scope.convertDateAndTime=function(value,name){$scope.datesettings[name]=formatedDate(value);};$scope.convertDateAndTime2=function(value,name){$scope.convertDateAndTime(value,name);$scope.search();};$scope.search=function(){if($scope.datesettings.isRange){$scope.searchByDate($scope.datesettings.rangeStart);}else{$scope.searchByDate($scope.datesettings.date);}};function formatedDate(date){return $filter("date")(date,"yyyy-MM-dd");}function defaultDateSettings(){$scope.datesettings.isNumberRange=false;}function readDateSettingsForRequest(){var request={isRange:$scope.datesettings.isRange,rangeStart:$scope.datesettings.rangeStart,rangeEnd:$scope.datesettings.rangeEnd,date:$scope.datesettings.date,isNumberRange:$scope.datesettings.isNumberRange,numberRange:$scope.datesettings.numberRange};if($scope.datesettings.isNumberRange){delete request.isRange;delete request.rangeStart;delete request.rangeEnd;delete request.date;return request;}if($scope.datesettings.isRange){delete request.date;delete request.isNumberRange;delete request.numberRange;}else{delete request.isRange;delete request.rangeStart;delete request.rangeEnd;delete request.isNumberRange;delete request.numberRange;}return request;}$scope.searchByDate=function(date){$scope.datesettings.loading=true;date=formatedDate(date);var request=readDateSettingsForRequest();console.info("request",request,"\n\ndatesettings\n",$scope.datesettings);$staticStorage.TimelineDao().list(request,function(data){if(data.success){$scope.data=data.data;}else{$scope.data=[];}defaultDateSettings();$scope.datesettings.loading=false;});};setTimeout(function(){$scope.searchByDate($scope.datesettings.date);},100);}]);tourismApp.controller("GanttCtrl",["$scope",,function($scope){$scope.data=[{name:"row1",tasks:[{name:"task1",from:"2013-10-07T09:00:00",to:"2013-10-08T09:00:00"},{name:"task2",from:"2013-10-07T09:00:00",to:"2013-11-07T09:00:00"}]},{name:"row2",tasks:[{name:"task3",from:"2013-05-07T09:00:00",to:"2013-12-07T09:00:00"},{name:"task4",from:"2013-10-03T09:00:00",to:"2013-10-09T09:00:00"}]}];}]);